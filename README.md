# Coindesk Article Embeddings Generator

This tool generates embeddings from Coindesk articles and stores them in both a local SQLite database and a Neon Postgres database for vector search capabilities.

## Features

- Reads article data from CSV files generated by the Coindesk scraper
- Generates embeddings using OpenAI's API (text-embedding-3-small model)
- Stores embeddings in both SQLite and Postgres databases
- Provides similarity search functionality to find related articles

## Setup

1. Install dependencies:

```bash
# Install dependencies
pipenv install

# Or if you want to install them manually:
pipenv install pandas openai sqlalchemy psycopg2-binary python-dotenv tqdm numpy
```

2. Create a `.env` file:

Copy the `.env.example` file to `.env` and fill in your API keys and database connection strings:

```bash
cp .env.example .env
# Then edit the .env file with your credentials
```

3. Make sure you have a CSV file with Coindesk articles (generated by the scraper)

## Usage

### Generate Embeddings

```bash
# Basic usage (uses default CSV file)
pipenv run python generate_embeddings.py

# Specify a different CSV file
pipenv run python generate_embeddings.py --csv your_articles.csv

# Specify a Postgres URL directly (instead of using .env)
pipenv run python generate_embeddings.py --postgres-url postgresql://user:pass@host:port/db

# Use a different embedding model
pipenv run python generate_embeddings.py --model text-embedding-3-large
```

### Search for Similar Articles

Once you've generated embeddings, you can search for similar articles:

```bash
# Search for articles related to a query
pipenv run python generate_embeddings.py --search "bitcoin price prediction"
```

## Database Schema

The script creates two tables in both databases:

### Articles Table

- `id`: Primary key
- `title`: Article title
- `url`: Article URL (unique)
- `author`: Article author
- `date`: Publication date
- `category`: Article category
- `summary`: Article summary
- `content`: Full article content
- `tags`: Article tags
- `created_at`: Timestamp when the record was created

### Embeddings Table

- `id`: Primary key
- `article_id`: Foreign key to articles table
- `model`: Embedding model used (e.g., "text-embedding-3-small")
- `embedding_type`: Type of embedding ("title", "content", or "combined")
- `vector_json`: Embedding vector stored as JSON (SQLite only)
- `vector_array`: Embedding vector stored as array (Postgres only)
- `created_at`: Timestamp when the record was created

## Notes

- The script generates three types of embeddings for each article:
  - `title`: Embedding of just the article title
  - `content`: Embedding of the article content (or summary if content is not available)
  - `combined`: Embedding of title and content combined
- By default, similarity search uses the "combined" embedding type
- The SQLite database is stored in `coindesk_embeddings.db` in the current directory
- For Postgres, vector similarity search can be optimized with pgvector extension
